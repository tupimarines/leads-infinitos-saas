{% extends 'base.html' %}
{% block title %}Gerador de Leads - Leads Infinitos{% endblock %}
{% block body %}
  <div class="hero">
    <div class="container">
      <h1 style="margin-top: 8px;">A próxima geração de prospecção</h1>
      <p>Extração de leads do Google Maps com padrão de produto global. Rápido, preciso e elegante.</p>
      {% if current_user.is_authenticated %}
        <div id="license-status" style="margin-top: 16px;">
          <!-- Status da licença será carregado via JavaScript -->
        </div>
      {% endif %}
    </div>
  </div>
  <div class="section">
    <div class="container" style="max-width: 920px;">
      <div class="grid grid-2">
        <div class="card" style="padding: 20px;">
          <h3 style="margin: 0 0 10px;">Nova Extração</h3>
          <p class="muted" style="margin-top: 4px;">Os resultados ficarão disponíveis para download ao final.</p>
          {% with messages = get_flashed_messages() %}
            {% if messages %}
              <div class="flash" style="margin-top:12px;">{{ messages[0] }}</div>
            {% endif %}
          {% endwith %}
          <form method="post" action="{{ url_for('scrape') }}" onsubmit="const btn=this.querySelector('button[type=submit]'); btn.disabled=true; btn.innerText='Extraindo...';">
            <div class="grid" style="gap:14px;">
              <div class="field">
                <label>Palavra‑chave</label>
                <input type="text" name="palavra_chave" required placeholder="Ex.: Veterinária, Dentista, Barbearia">
              </div>
              <div class="field">
                <label>Localização</label>
                <input type="text" name="localizacao" required placeholder="Ex.: Campinas, SP">
              </div>
              <div class="field">
                <label>Total de resultados <span class="muted">(opcional)</span></label>
                <input type="number" name="total" min="1" max="500" placeholder="100">
              </div>
              <div>
                <button class="btn btn-primary" type="submit" style="width:100%; height:48px; font-weight:700;">Iniciar Extração</button>
              </div>
            </div>
          </form>
        </div>
        <div class="grid" style="gap: 14px;">
          <div class="card" style="padding: 16px;">
            <h4 style="margin:0 0 6px;">Design orientado a produto</h4>
            <div class="muted">Experiência fluida, foco no essencial e qualidade de dados em primeiro lugar.</div>
          </div>
          <div class="card" style="padding: 16px;">
            <h4 style="margin:0 0 6px;">Desempenho e precisão</h4>
            <div class="muted">Resultados consistentes e exportação pronta para CRMs (CSV/Excel).</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% if current_user.is_authenticated %}
  <script>
    // Verificar status da licença
    fetch('/api/verify-license')
      .then(response => response.json())
      .then(data => {
        const statusDiv = document.getElementById('license-status');
        if (data.has_active_license) {
          statusDiv.innerHTML = '<div class="badge" style="background: rgba(25,195,125,.18); border-color: rgba(25,195,125,.35); color: #19c37d;">✓ Licença Ativa</div>';
        } else {
          statusDiv.innerHTML = '<div class="badge" style="background: rgba(255,93,93,.18); border-color: rgba(255,93,93,.35); color: #ff5d5d;">⚠ Licença Expirada</div>';
        }
      })
      .catch(error => {
        console.error('Erro ao verificar licença:', error);
      });
  </script>
  {% endif %}
{% endblock %}